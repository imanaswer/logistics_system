module.exports=[24361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},14747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},45056,(a,b,c)=>{"use strict";b.exports=a.r(31699).vendored["react-ssr"].React},2057,(a,b,c)=>{"use strict";b.exports=a.r(31699).vendored.contexts.AppRouterContext},3420,(a,b,c)=>{"use strict";b.exports=a.r(31699).vendored.contexts.HooksClientContext},98823,(a,b,c)=>{"use strict";b.exports=a.r(31699).vendored.contexts.ServerInsertedHtml},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},31699,(a,b,c)=>{"use strict";b.exports=a.r(18622)},57850,(a,b,c)=>{"use strict";b.exports=a.r(31699).vendored["react-ssr"].ReactJsxRuntime},14102,a=>{"use strict";let b=process.env.NEXT_PUBLIC_API_URL||"https://logistics-system-oq8b.onrender.com";a.s(["API_URL",0,b])},60304,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(73951),e=a.i(93609),f=a.i(14102);let g=()=>(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M5 13l4 4L19 7"})}),h=()=>(0,b.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M12 4v16m8-8H4"})}),i=()=>(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),j={charge_type:"",description:"",amount:"",isTaxable:!1,vat:0,total:0};function k(){let a=(0,e.useRouter)(),k=(0,e.useParams)(),l=k?.jobId||k?.id,[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)([j]),[s,t]=(0,c.useState)(0),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)(!0),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)([]),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(""),[O,P]=(0,c.useState)(null);(0,c.useEffect)(()=>{l&&(async()=>{let a=localStorage.getItem("token");if(!a){window.location.href="/login";return}try{let b={headers:{Authorization:`Token ${a}`}},[c,e,g,h]=await Promise.all([d.default.get(`${f.API_URL}/api/jobs/${l}/`,b),d.default.get(`${f.API_URL}/api/chargetypes/`,b),d.default.get(`${f.API_URL}/api/invoice-items/?job=${l}`,b),d.default.get(`${f.API_URL}/api/transactions/`,b)]),i=c.data;n(i),p(e.data);let j=h.data.filter(a=>a.job===Number(l)&&["CR","BR"].includes(a.trans_type)).reduce((a,b)=>a+Number(b.amount),0);t(j),v(i.invoice_no||`INV-${new Date().getFullYear()}-${String(l).padStart(3,"0")}`),z(i.transport_document_no||"");let k=i.shipment_invoice_no||"",m="",o="",q="";if(k.includes("(")){let a=k.split("(");q=a.slice(1).join("(").replace(/\)$/,""),k=a[0].trim()}if(k.includes("|||")){let a=k.split("|||");m=a[0].trim(),o=a[1]?.trim()||""}else m=k.includes("||")?k.split("||")[1].trim():k;x(m),B(o),D(q),g.data&&g.data.length>0&&(r(g.data.map(a=>({charge_type:String(a.charge_type),description:a.description,amount:Number(a.amount),isTaxable:Number(a.vat)>0,vat:Number(a.vat),total:Number(a.total)}))),J(g.data.map(a=>a.id))),F(!1)}catch(a){console.error(a),F(!1)}})()},[l]);let Q=async()=>{let a=localStorage.getItem("token");if(M.trim()&&a)try{let b={headers:{Authorization:`Token ${a}`}},c=(await d.default.post(`${f.API_URL}/api/chargetypes/`,{name:M},b)).data;p(a=>[...a,c]),null!==O&&R(O,"charge_type",String(c.id)),L(!1),N(""),P(null)}catch(a){alert("Failed to add header.")}},R=(a,b,c)=>{r(d=>{let e=[...d],f={...e[a],[b]:c};if("charge_type"===b){let a=o.find(a=>String(a.id)===c);a&&(f.isTaxable=!!a.name.toLowerCase().match(/custom|transport|handling|agency|clearance/))}let g=Number(f.amount)||0;return("amount"===b||"isTaxable"===b||"charge_type"===b)&&(f.vat=f.isTaxable?.05*g:0,f.total=g+f.vat),e[a]=f,e})},S=async()=>{let b=localStorage.getItem("token"),c=C.trim();c&&!c.startsWith("(")?c=` (${c})`:c&&(c=` ${c}`);let e=`${w} ||| ${A}${c}`;if(e.length>1e3)return alert("Text too long.");H(!0);try{let c={headers:{Authorization:`Token ${b}`}};await d.default.patch(`${f.API_URL}/api/jobs/${l}/`,{invoice_no:u,transport_document_no:y,shipment_invoice_no:e,vat_number:m.vat_number},c),await Promise.allSettled(I.map(a=>d.default.delete(`${f.API_URL}/api/invoice-items/${a}/`,c)));let g=q.filter(a=>a.charge_type&&Number(a.amount)>0);await Promise.all(g.map(a=>d.default.post(`${f.API_URL}/api/invoice-items/`,{job:Number(l),charge_type:Number(a.charge_type),description:a.description,amount:Number(a.amount),vat:Number(a.vat.toFixed(3)),total:Number(a.total.toFixed(3))},c))),a.push(`/invoices/${l}/view`)}catch(a){alert("Save failed"),H(!1)}},T=(0,c.useMemo)(()=>q.reduce((a,b)=>({sub:a.sub+(Number(b.amount)||0),vat:a.vat+b.vat,total:a.total+b.total}),{sub:0,vat:0,total:0}),[q]),U=T.total-s;return E?(0,b.jsx)("div",{className:"h-screen flex items-center justify-center font-bold text-slate-400",children:"LOADING..."}):(0,b.jsxs)("div",{className:"min-h-screen bg-slate-100 p-4 md:p-8 flex justify-center items-center font-sans text-slate-900",children:[(0,b.jsxs)("div",{className:"w-full max-w-6xl bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col md:flex-row min-h-[600px]",children:[(0,b.jsxs)("div",{className:"flex-grow p-8 md:p-10 flex flex-col relative",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-2xl font-black tracking-tight mb-1 flex items-center gap-3",children:[(0,b.jsx)("span",{className:"bg-black text-white p-2 rounded-lg",children:(0,b.jsx)(g,{})}),"Billing Generator"]}),(0,b.jsxs)("div",{className:"flex gap-3 text-[10px] font-bold uppercase tracking-widest text-slate-400 mt-1",children:[(0,b.jsxs)("span",{children:["Job ID: #",l]}),(0,b.jsx)("span",{children:"|"}),(0,b.jsxs)("span",{children:["Date: ",m.job_date]})]})]}),(0,b.jsx)("button",{onClick:()=>a.push("/"),className:"text-slate-400 hover:text-red-500 transition",children:(0,b.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,b.jsxs)("div",{className:"bg-slate-50 p-6 rounded-2xl border border-slate-100 mb-8",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-[10px] font-black text-slate-400 uppercase mb-1",children:"Invoice No"}),(0,b.jsx)("input",{className:"w-full bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm font-bold outline-none focus:border-blue-500",value:u,onChange:a=>v(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-[10px] font-black text-slate-400 uppercase mb-1",children:"Supplier Reference"}),(0,b.jsx)("input",{className:"w-full bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm font-bold outline-none focus:border-blue-500",value:w,onChange:a=>x(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-[10px] font-black text-slate-400 uppercase mb-1",children:"BL / Ref No"}),(0,b.jsx)("input",{className:"w-full bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm font-bold outline-none focus:border-blue-500",value:y,onChange:a=>z(a.target.value),placeholder:"e.g. AWB-123456"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-[10px] font-black text-slate-400 uppercase mb-1",children:"Logistics Manifest (Qty + Type)"}),(0,b.jsx)("input",{className:"w-full bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm font-bold outline-none focus:border-blue-500",value:C,onChange:a=>D(a.target.value),placeholder:"e.g. 1x40 ft reefer"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-[10px] font-black text-slate-400 uppercase mb-1",children:"Supplier Information / Description"}),(0,b.jsx)("textarea",{className:"w-full bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm font-medium outline-none focus:border-blue-500 h-20 resize-none",value:A,onChange:a=>B(a.target.value),placeholder:"Enter details..."})]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-end mb-2 px-2",children:[(0,b.jsx)("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Line Item Details"}),(0,b.jsxs)("button",{onClick:()=>r([...q,{...j}]),className:"text-[10px] font-black text-blue-600 uppercase flex items-center gap-1 hover:underline",children:[(0,b.jsx)(h,{})," Add New Row"]})]}),(0,b.jsx)("div",{className:"space-y-3 mb-8",children:q.map((a,c)=>(0,b.jsxs)("div",{className:"flex gap-3 items-center group",children:[(0,b.jsxs)("select",{className:"w-1/4 bg-white border border-slate-200 rounded-xl px-3 py-3 text-sm font-bold focus:border-blue-500 outline-none shadow-sm",value:a.charge_type,onChange:a=>{"ADD_NEW"===a.target.value?(P(c),L(!0)):R(c,"charge_type",a.target.value)},children:[(0,b.jsx)("option",{value:"",children:"-- Type --"}),o.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id)),(0,b.jsx)("option",{value:"ADD_NEW",className:"font-black text-blue-600 bg-blue-50",children:"+ Add Custom Header..."})]}),(0,b.jsx)("input",{className:"flex-grow bg-white border border-slate-200 rounded-xl px-3 py-3 text-sm font-bold focus:border-blue-500 outline-none shadow-sm",placeholder:"Details...",value:a.description,onChange:a=>R(c,"description",a.target.value)}),(0,b.jsx)("div",{className:"flex items-center justify-center px-1",title:"Apply 5% VAT",children:(0,b.jsx)("input",{type:"checkbox",checked:a.isTaxable,onChange:a=>R(c,"isTaxable",a.target.checked),className:"w-5 h-5 rounded border-slate-300 text-blue-600 focus:ring-blue-500 cursor-pointer accent-blue-600"})}),(0,b.jsx)("input",{type:"number",className:"w-28 bg-white border border-slate-200 rounded-xl px-3 py-3 text-sm font-bold text-right focus:border-blue-500 outline-none shadow-sm",placeholder:"0.000",value:a.amount,onChange:a=>R(c,"amount",a.target.value)}),(0,b.jsx)("button",{onClick:()=>r(q.filter((a,b)=>b!==c)),className:"text-slate-300 hover:text-red-500 p-2 opacity-0 group-hover:opacity-100 transition",children:(0,b.jsx)(i,{})})]},c))})]}),(0,b.jsxs)("div",{className:"w-full md:w-96 bg-slate-50 border-l border-slate-200 p-8 md:p-10 flex flex-col justify-center",children:[(0,b.jsx)("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-6",children:"Accounting Summary"}),(0,b.jsxs)("div",{className:"space-y-4 text-sm font-bold text-slate-600 mb-8",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Gross Subtotal"}),(0,b.jsx)("span",{children:T.sub.toFixed(3)})]}),(0,b.jsxs)("div",{className:"flex justify-between text-blue-600",children:[(0,b.jsx)("span",{children:"Tax (Oman 5%)"}),(0,b.jsxs)("span",{children:["+",T.vat.toFixed(3)]})]}),(0,b.jsx)("div",{className:"h-px bg-slate-200 my-2"}),(0,b.jsxs)("div",{className:"flex justify-between text-slate-900",children:[(0,b.jsx)("span",{children:"Invoice Amount"}),(0,b.jsx)("span",{children:T.total.toFixed(3)})]}),s>0&&(0,b.jsxs)("div",{className:"flex justify-between text-emerald-600 text-xs",children:[(0,b.jsx)("span",{children:"Prior Credits"}),(0,b.jsxs)("span",{children:["-",s.toFixed(3)]})]})]}),(0,b.jsxs)("div",{className:"bg-slate-900 rounded-2xl p-6 text-white shadow-xl mb-8",children:[(0,b.jsx)("span",{className:"block text-[10px] font-bold text-slate-400 uppercase mb-1",children:"Net Balance Due (OMR)"}),(0,b.jsx)("span",{className:"block text-4xl font-black tracking-tight",children:U>0?U.toFixed(3):"0.000"})]}),(0,b.jsx)("button",{onClick:S,disabled:G,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg transition text-xs uppercase tracking-widest disabled:opacity-50",children:G?"Processing...":"Finalize & Record"})]})]}),K&&(0,b.jsx)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 space-y-4 animate-in fade-in zoom-in duration-200",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h3",{className:"text-lg font-black text-slate-900",children:"New Custom Header"}),(0,b.jsx)("p",{className:"text-xs text-slate-400",children:"Add a new category to your billing types."})]}),(0,b.jsx)("input",{autoFocus:!0,value:M,onChange:a=>N(a.target.value),placeholder:"e.g. Special Handling Fee",className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-sm font-bold focus:ring-2 focus:ring-blue-500 outline-none",onKeyDown:a=>"Enter"===a.key&&Q()}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsx)("button",{onClick:()=>L(!1),className:"py-3 rounded-xl text-xs font-bold uppercase tracking-wider text-slate-500 hover:bg-slate-100 transition",children:"Cancel"}),(0,b.jsx)("button",{onClick:Q,disabled:!M.trim(),className:"py-3 rounded-xl text-xs font-bold uppercase tracking-wider bg-black text-white hover:bg-blue-600 shadow-lg transition disabled:opacity-50",children:"Save & Add"})]})]})})]})}a.s(["default",()=>k])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__dcfbfc27._.js.map