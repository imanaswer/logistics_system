module.exports=[24361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},14747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},45056,(a,b,c)=>{"use strict";b.exports=a.r(31699).vendored["react-ssr"].React},2057,(a,b,c)=>{"use strict";b.exports=a.r(31699).vendored.contexts.AppRouterContext},3420,(a,b,c)=>{"use strict";b.exports=a.r(31699).vendored.contexts.HooksClientContext},98823,(a,b,c)=>{"use strict";b.exports=a.r(31699).vendored.contexts.ServerInsertedHtml},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},31699,(a,b,c)=>{"use strict";b.exports=a.r(18622)},57850,(a,b,c)=>{"use strict";b.exports=a.r(31699).vendored["react-ssr"].ReactJsxRuntime},14102,a=>{"use strict";let b=process.env.NEXT_PUBLIC_API_URL||"https://logistics-system-oq8b.onrender.com";a.s(["API_URL",0,b])},68611,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(73951),e=a.i(93609),f=a.i(14102);let g=`${f.API_URL}/api`,h={charge_type:"",description:"",amount:"",vat:0,total:0},i=()=>(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M12 4v16m8-8H4"})}),j=()=>(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),k=()=>(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),l=()=>(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M5 13l4 4L19 7"})});function m(){let a=(0,e.useRouter)(),f=(0,e.useParams)(),m=f?.jobId,[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)([]),[r,s]=(0,c.useState)([h]),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)(!0),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)(null),J=(0,c.useMemo)(()=>null,[]);(0,c.useEffect)(()=>{J?m&&(async()=>{try{let[a,b,c]=await Promise.all([d.default.get(`${g}/jobs/${m}/`,J),d.default.get(`${g}/chargetypes/`,J),d.default.get(`${g}/invoice-items/?job=${m}`,J)]);o(a.data),u(a.data.transport_document_no??""),w(a.data.vat_number??""),q(b.data);let e=c.data;e&&e.length>0?(s(e.map(a=>({charge_type:String(a.charge_type),description:a.description||"",amount:Number(a.amount),vat:Number(a.vat),total:Number(a.total)}))),y(e.map(a=>a.id))):(s([h]),y([]))}catch(b){console.error("Load error:",b),a.push("/")}finally{A(!1)}})():a.push("/login")},[J,m,a]);let K=async()=>{if(F.trim()&&J)try{let a=(await d.default.post(`${g}/chargetypes/`,{name:F},J)).data;q(b=>[...b,a]),null!==H&&L(H,"charge_type",String(a.id)),E(!1),G(""),I(null)}catch(a){alert("Failed to add header. It might already exist.")}},L=(a,b,c)=>{s(d=>{let e=[...d],f={...e[a],[b]:c},g=""===f.amount?0:Number(f.amount);if("amount"===b||"charge_type"===b){let a=p.find(a=>String(a.id)===f.charge_type);f.vat=a?.name?.toLowerCase().match(/custom|transport|handling|agency|fee|clearance/)?.05*g:0}return f.total=g+f.vat,e[a]=f,e})},M=async()=>{if(J&&m){C(!0);try{await d.default.patch(`${g}/jobs/${m}/`,{transport_document_no:t,vat_number:v},J);let b=(await d.default.get(`${g}/invoice-items/?job=${m}`,J)).data.map(a=>a.id);b.length>0&&await Promise.all(b.map(a=>d.default.delete(`${g}/invoice-items/${a}/`,J)));let c=r.filter(a=>a.charge_type&&Number(a.amount)>0);await Promise.all(c.map(a=>d.default.post(`${g}/invoice-items/`,{job:Number(m),charge_type:Number(a.charge_type),description:a.description||"Charge",amount:a.amount,vat:a.vat,total:a.total},J))),a.push(`/invoices/${m}/view`)}catch(a){console.error("Save error:",a),alert("Save failed. Please check your data.")}finally{C(!1)}}},N=(0,c.useMemo)(()=>r.reduce((a,b)=>({subtotal:a.subtotal+(Number(b.amount)||0),vat:a.vat+(Number(b.vat)||0),grand:a.grand+(Number(b.total)||0)}),{subtotal:0,vat:0,grand:0}),[r]);return z?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 font-black text-slate-400",children:"LOADING..."}):(0,b.jsxs)("div",{className:"min-h-screen bg-[#F8FAFC] text-slate-900 antialiased pb-20",children:[(0,b.jsx)("header",{className:"bg-white border-b border-slate-200 sticky top-0 z-50",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto px-6 h-20 flex justify-between items-center",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("button",{onClick:()=>a.push("/"),className:"p-2.5 hover:bg-slate-100 rounded-xl transition-all text-slate-400 hover:text-slate-900",children:(0,b.jsx)(k,{})}),(0,b.jsx)("div",{className:"h-8 w-[1px] bg-slate-200 mx-2 hidden md:block"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-lg font-black tracking-tight uppercase",children:"Billing Editor"}),(0,b.jsxs)("p",{className:"text-[10px] font-bold text-blue-600 uppercase tracking-widest",children:["Job ID: #",m," | Ref: ",n?.invoice_no||"Draft"]})]})]}),(0,b.jsx)("button",{onClick:M,disabled:B,className:"bg-black hover:bg-blue-700 disabled:bg-slate-300 text-white px-8 py-3 rounded-2xl font-black text-xs uppercase tracking-[0.15em] transition-all shadow-xl flex items-center gap-3",children:B?"Syncing...":(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l,{})," Finalize & Save"]})})]})}),(0,b.jsxs)("main",{className:"max-w-7xl mx-auto p-6 md:p-10 grid grid-cols-12 gap-8",children:[(0,b.jsx)("div",{className:"col-span-12 lg:col-span-8 space-y-6",children:(0,b.jsxs)("div",{className:"bg-white rounded-[2rem] border border-slate-200 shadow-sm overflow-hidden",children:[(0,b.jsxs)("div",{className:"px-8 py-6 border-b border-slate-100 flex justify-between items-center bg-slate-50/30",children:[(0,b.jsx)("h2",{className:"text-xs font-black text-slate-400 uppercase tracking-[0.2em]",children:"Service Statement"}),(0,b.jsxs)("button",{onClick:()=>s([...r,{...h}]),className:"text-blue-600 hover:text-black transition flex items-center gap-1 text-xs font-black uppercase",children:[(0,b.jsx)(i,{})," Add Row"]})]}),(0,b.jsx)("div",{className:"p-6 md:p-8 space-y-4",children:r.map((a,c)=>(0,b.jsxs)("div",{className:"group grid grid-cols-12 gap-4 items-end p-5 rounded-2xl bg-slate-50/50 border-2 border-transparent hover:border-blue-100 hover:bg-white transition-all",children:[(0,b.jsxs)("div",{className:"col-span-12 md:col-span-4 relative",children:[(0,b.jsx)("label",{className:"text-[10px] font-black text-slate-400 uppercase mb-2 block",children:"Category"}),(0,b.jsxs)("select",{className:"w-full bg-white border border-slate-200 rounded-xl text-sm font-bold h-12 px-4 focus:ring-2 focus:ring-blue-500 outline-none transition-all appearance-none",value:a.charge_type,onChange:a=>{"ADD_NEW"===a.target.value?(I(c),E(!0)):L(c,"charge_type",a.target.value)},children:[(0,b.jsx)("option",{value:"",children:"Select Type"}),p.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id)),(0,b.jsx)("option",{value:"ADD_NEW",className:"font-black text-blue-600 bg-blue-50",children:"+ Add Custom Header..."})]}),(0,b.jsx)("div",{className:"absolute right-4 top-[2.4rem] pointer-events-none text-slate-400",children:(0,b.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})})]}),(0,b.jsxs)("div",{className:"col-span-12 md:col-span-5",children:[(0,b.jsx)("label",{className:"text-[10px] font-black text-slate-400 uppercase mb-2 block",children:"Description"}),(0,b.jsx)("input",{className:"w-full bg-white border border-slate-200 rounded-xl text-sm font-bold h-12 px-4 focus:ring-2 focus:ring-blue-500 outline-none transition-all",value:a.description,onChange:a=>L(c,"description",a.target.value),placeholder:"Details..."})]}),(0,b.jsxs)("div",{className:"col-span-10 md:col-span-2",children:[(0,b.jsx)("label",{className:"text-[10px] font-black text-slate-400 uppercase mb-2 block text-right",children:"Amount (OMR)"}),(0,b.jsx)("input",{type:"number",step:"0.001",className:"w-full bg-white border border-slate-200 rounded-xl text-sm font-black h-12 px-4 text-right focus:ring-2 focus:ring-blue-500 outline-none transition-all",value:a.amount,onChange:a=>L(c,"amount",a.target.value)})]}),(0,b.jsx)("div",{className:"col-span-2 md:col-span-1 flex justify-center pb-2",children:(0,b.jsx)("button",{onClick:()=>r.length>1&&s(r.filter((a,b)=>b!==c)),className:"text-slate-300 hover:text-red-500 transition-all p-2",children:(0,b.jsx)(j,{})})})]},c))})]})}),(0,b.jsxs)("div",{className:"col-span-12 lg:col-span-4 space-y-6",children:[(0,b.jsx)("div",{className:"bg-blue-600 rounded-[2rem] p-8 text-white shadow-2xl shadow-blue-200 relative overflow-hidden",children:(0,b.jsxs)("div",{className:"relative z-10",children:[(0,b.jsx)("h3",{className:"text-xs font-black text-blue-200 uppercase tracking-[0.2em] mb-4",children:"Customer Details"}),(0,b.jsx)("p",{className:"text-xl font-black leading-tight mb-6",children:n?.client_details?.name||n?.client?.name||"Loading..."}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 pt-4 border-t border-blue-500",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-[10px] font-black text-blue-200 uppercase",children:"VAT / TRN"}),(0,b.jsx)("input",{value:v,onChange:a=>w(a.target.value),className:"w-full bg-blue-700/50 border-none rounded-xl px-4 py-3 text-sm font-black placeholder:text-blue-400 focus:ring-2 focus:ring-white outline-none mt-1"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-[10px] font-black text-blue-200 uppercase",children:"Transport Ref (AWB/BL)"}),(0,b.jsx)("input",{value:t,onChange:a=>u(a.target.value),className:"w-full bg-blue-700/50 border-none rounded-xl px-4 py-3 text-sm font-black placeholder:text-blue-400 focus:ring-2 focus:ring-white outline-none mt-1"})]})]})]})}),(0,b.jsx)("div",{className:"bg-white rounded-[2rem] border border-slate-200 p-8 shadow-sm",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center text-xs font-bold uppercase tracking-widest text-slate-400",children:[(0,b.jsx)("span",{children:"Subtotal"}),(0,b.jsx)("span",{className:"text-slate-900",children:N.subtotal.toFixed(3)})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center text-xs font-bold uppercase tracking-widest text-slate-400",children:[(0,b.jsx)("span",{children:"VAT (5%)"}),(0,b.jsxs)("span",{className:"text-blue-600",children:["+",N.vat.toFixed(3)]})]}),(0,b.jsxs)("div",{className:"pt-6 mt-2 border-t border-slate-100 flex justify-between items-end",children:[(0,b.jsx)("span",{className:"text-xs font-black uppercase text-slate-900",children:"Grand Total"}),(0,b.jsx)("span",{className:"text-4xl font-black tracking-tighter text-slate-900 tabular-nums",children:N.grand.toFixed(3)})]})]})})]})]}),D&&(0,b.jsx)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-200",children:(0,b.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 space-y-4 scale-100",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h3",{className:"text-lg font-black text-slate-900",children:"New Custom Header"}),(0,b.jsx)("p",{className:"text-xs text-slate-400",children:"Enter the name for this new charge category."})]}),(0,b.jsx)("input",{autoFocus:!0,value:F,onChange:a=>G(a.target.value),placeholder:"e.g. Special Handling Fee",className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-sm font-bold focus:ring-2 focus:ring-blue-500 outline-none",onKeyDown:a=>"Enter"===a.key&&K()}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsx)("button",{onClick:()=>E(!1),className:"py-3 rounded-xl text-xs font-bold uppercase tracking-wider text-slate-500 hover:bg-slate-100 transition",children:"Cancel"}),(0,b.jsx)("button",{onClick:K,disabled:!F.trim(),className:"py-3 rounded-xl text-xs font-bold uppercase tracking-wider bg-black text-white hover:bg-blue-600 shadow-lg shadow-blue-500/20 transition disabled:opacity-50",children:"Save & Add"})]})]})})]})}a.s(["default",()=>m])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__9ec95310._.js.map